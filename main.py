import executer as exc
from flask import render_template, Flask, request, Response
from shelljob import proc
import flask
from jinja2 import Environment
from jinja2.loaders import FileSystemLoader

app = Flask(__name__)
 
# assume that your homepage shows the console output.

@app.route('/')
def home():
	return render_template('homepage.html')

@app.route('/scan',methods=['GET', 'POST'])
def scan():
	result = None
	if request.method == 'POST':
		url = request.form['text']
		g = proc.Group()
    		#p = g.run( [ "nmap", "-PN", "-n", "-F", "-T4", "-sV", "-A", "--version-intensity", "5", url ] )
                p = g.run([ "nmap", url ])

		def read_process():
			while g.is_pending():   
				lines = g.readlines()
				for proc, line in lines:
					yield line + "\n\n"
		result = read_process()
		env = Environment(loader=FileSystemLoader('templates'))
    		tmpl = env.get_template('output.html')
    		return flask.Response(tmpl.generate(result=result),mimetype= 'text/html')
		#return	flask.Response( read_process(), mimetype= 'text/event-stream' )	
		#output, errors= exc.execute(['nmap', "ginar.io"])
		#return Response(stream_template('output.html',console_gave = read_process()))
       		#return render_template('output.html',console_gave = [output, errors])

if __name__ == '__main__':
	app.debug = True
	app.run()
